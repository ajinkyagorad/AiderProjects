<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced AI Interface</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #000;
            color: #fff;
            display: flex;
            height: 100vh;
            font-size: 18px;
        }
        #main-container {
            display: flex;
            flex: 1;
        }
        #left-panel {
            flex: 2;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        #right-panel {
            flex: 1;
            padding: 20px;
            border-left: 1px solid #333;
            overflow-y: auto;
        }
        #chat-history {
            flex: 1;
            overflow-y: auto;
            border: 1px solid #333;
            padding: 10px;
            margin-bottom: 10px;
        }
        #input-container {
            display: flex;
            margin-bottom: 10px;
        }
        #user-input {
            flex: 1;
            padding: 10px;
            background-color: #222;
            color: #fff;
            border: none;
            font-size: 16px;
        }
        button {
            padding: 10px;
            background-color: #0066cc;
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        #api-key-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #222;
            color: #fff;
            border: none;
            font-size: 16px;
        }
        .card {
            background-color: #222;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .card.expanded {
            height: 200px;
            overflow-y: auto;
        }
        #canvas-container {
            position: relative;
            width: 100%;
            height: 300px;
            border: 1px solid #333;
        }
        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }
        #help-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        #help-panel {
            position: fixed;
            bottom: 0;
            right: 0;
            width: 300px;
            height: 0;
            background-color: rgba(0, 0, 0, 0.8);
            overflow: hidden;
            transition: height 0.3s;
        }
        #help-content {
            padding: 20px;
        }
        #starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        #transcription {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <canvas id="starfield"></canvas>
    <div id="main-container">
        <div id="left-panel">
            <input type="password" id="api-key-input" placeholder="Enter your OpenAI API key">
            <div id="transcription"></div>
            <div id="chat-history"></div>
            <div id="input-container">
                <input type="text" id="user-input" placeholder="Type your message or command...">
                <button id="send-button">Send</button>
                <button id="voice-button">Voice</button>
                <button id="speak-button">Speak Response</button>
            </div>
            <div id="canvas-container">
                <canvas id="drawing-canvas"></canvas>
            </div>
        </div>
        <div id="right-panel"></div>
    </div>
    <button id="help-button">Help</button>
    <div id="help-panel">
        <div id="help-content">
            <h2>Help Instructions</h2>
            <p>1. Enter your OpenAI API key at the top.</p>
            <p>2. Type messages or use voice commands.</p>
            <p>3. Use drawing commands like "draw rectangle" or "draw circle".</p>
            <p>4. Say "summarize chat" to get a summary of the conversation.</p>
            <p>5. Use "store output" to save important information as a card.</p>
            <p>6. Say "open card 1" or "show card 2" to view saved cards.</p>
            <p>7. Use "change color to red" to modify drawing colors.</p>
            <p>8. Say "generate image of [description]" to create images.</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // OpenAI API integration
        const apiKeyInput = document.getElementById('api-key-input');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const voiceButton = document.getElementById('voice-button');
        const speakButton = document.getElementById('speak-button');
        const chatHistory = document.getElementById('chat-history');
        const rightPanel = document.getElementById('right-panel');
        const helpButton = document.getElementById('help-button');
        const helpPanel = document.getElementById('help-panel');
        const canvas = document.getElementById('drawing-canvas');
        const ctx = canvas.getContext('2d');
        const transcriptionDiv = document.getElementById('transcription');

        let chatMessages = [];
        let cardCount = 0;

        // Set up canvas
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;

        // Starfield animation
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('starfield') });
        renderer.setSize(window.innerWidth, window.innerHeight);

        const starGeometry = new THREE.BufferGeometry();
        const starMaterial = new THREE.PointsMaterial({ color: 0xFFFFFF, size: 0.1 });
        const starVertices = [];
        for (let i = 0; i < 10000; i++) {
            const x = (Math.random() - 0.5) * 2000;
            const y = (Math.random() - 0.5) * 2000;
            const z = (Math.random() - 0.5) * 2000;
            starVertices.push(x, y, z);
        }
        starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
        const stars = new THREE.Points(starGeometry, starMaterial);
        scene.add(stars);

        camera.position.z = 1;

        function animateStars() {
            requestAnimationFrame(animateStars);
            stars.rotation.y += 0.0002;
            renderer.render(scene, camera);
        }
        animateStars();

        // Event listeners
        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
        voiceButton.addEventListener('click', startVoiceRecognition);
        speakButton.addEventListener('click', speakResponse);
        helpButton.addEventListener('click', toggleHelpPanel);

        // Functions
        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;

            addToChatHistory('User', message);
            userInput.value = '';

            if (message.toLowerCase().includes('summarize chat')) {
                summarizeChat();
            } else if (message.toLowerCase().startsWith('draw ')) {
                handleDrawCommand(message);
            } else if (message.toLowerCase().startsWith('change color to ')) {
                changeColor(message.toLowerCase().replace('change color to ', ''));
            } else if (message.toLowerCase().startsWith('store output')) {
                storeOutput(message.replace('store output', '').trim());
            } else if (message.toLowerCase().match(/^(open|show) card \d+$/)) {
                const cardNumber = parseInt(message.match(/\d+/)[0]);
                showCard(cardNumber);
            } else if (message.toLowerCase().startsWith('generate image of ')) {
                await generateImage(message.replace('generate image of ', '').trim());
            } else {
                const response = await getAIResponse(message);
                addToChatHistory('AI', response);
            }
        }

        async function getAIResponse(message) {
            const apiKey = apiKeyInput.value;
            if (!apiKey) {
                return 'Please enter your OpenAI API key.';
            }

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [{ role: 'user', content: message }]
                    })
                });

                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error('Error:', error);
                return 'An error occurred while fetching the AI response.';
            }
        }

        async function generateImage(prompt) {
            const apiKey = apiKeyInput.value;
            if (!apiKey) {
                addToChatHistory('System', 'Please enter your OpenAI API key.');
                return;
            }

            try {
                const response = await fetch('https://api.openai.com/v1/images/generations', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        n: 1,
                        size: "256x256"
                    })
                });

                const data = await response.json();
                if (data.data && data.data[0].url) {
                    const imgElement = document.createElement('img');
                    imgElement.src = data.data[0].url;
                    imgElement.alt = prompt;
                    imgElement.style.maxWidth = '100%';
                    addToChatHistory('AI', '');
                    chatHistory.lastElementChild.appendChild(imgElement);
                } else {
                    addToChatHistory('System', 'Failed to generate image.');
                }
            } catch (error) {
                console.error('Error:', error);
                addToChatHistory('System', 'An error occurred while generating the image.');
            }
        }

        function addToChatHistory(role, message) {
            chatMessages.push({ role, message });
            const messageElement = document.createElement('p');
            messageElement.innerHTML = `<strong>${role}:</strong> ${message}`;
            chatHistory.appendChild(messageElement);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        function summarizeChat() {
            const summary = chatMessages.map(msg => `${msg.role}: ${msg.message}`).join('\n');
            addToChatHistory('System', 'Chat Summary:\n' + summary);
        }

        function handleDrawCommand(command) {
            const shape = command.toLowerCase().replace('draw ', '');
            ctx.beginPath();
            switch (shape) {
                case 'rectangle':
                    ctx.rect(50, 50, 100, 80);
                    break;
                case 'circle':
                    ctx.arc(100, 100, 50, 0, 2 * Math.PI);
                    break;
                case 'triangle':
                    ctx.moveTo(100, 50);
                    ctx.lineTo(50, 150);
                    ctx.lineTo(150, 150);
                    ctx.closePath();
                    break;
                // Add more shapes as needed
            }
            ctx.stroke();
        }

        function changeColor(color) {
            ctx.strokeStyle = color;
        }

        function storeOutput(content) {
            cardCount++;
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `<strong>Card ${cardCount}:</strong> ${content}`;
            card.addEventListener('click', () => card.classList.toggle('expanded'));
            rightPanel.appendChild(card);
        }

        function showCard(cardNumber) {
            const cards = rightPanel.getElementsByClassName('card');
            if (cardNumber > 0 && cardNumber <= cards.length) {
                cards[cardNumber - 1].classList.add('expanded');
            }
        }

        function startVoiceRecognition() {
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'en-US';
            recognition.continuous = true;
            recognition.interimResults = true;

            recognition.onresult = (event) => {
                let interimTranscript = '';
                let finalTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        finalTranscript += event.results[i][0].transcript;
                        processVoiceCommand(finalTranscript.trim());
                    } else {
                        interimTranscript += event.results[i][0].transcript;
                    }
                }

                transcriptionDiv.innerHTML = finalTranscript + '<i style="color: #999;">' + interimTranscript + '</i>';
            };

            recognition.start();
        }

        function processVoiceCommand(command) {
            userInput.value = command;
            sendMessage();
        }

        function speakResponse() {
            const lastAIMessage = chatMessages.filter(msg => msg.role === 'AI').pop();
            if (lastAIMessage) {
                const utterance = new SpeechSynthesisUtterance(lastAIMessage.message);
                window.speechSynthesis.speak(utterance);
            }
        }

        function toggleHelpPanel() {
            helpPanel.style.height = helpPanel.style.height === '300px' ? '0' : '300px';
        }

        // Window resize handler
        window.addEventListener('resize', () => {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
