<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced AI Interface</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #000;
            color: #fff;
            display: flex;
            height: 100vh;
            font-size: 18px;
            overflow: hidden;
        }
        @keyframes fadeInOut {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        #main-container {
            display: flex;
            flex: 1;
        }
        #left-panel {
            flex: 2;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        #right-panel {
            flex: 1;
            padding: 20px;
            border-left: 1px solid #333;
            overflow-y: auto;
        }
        #chat-history {
            flex: 1;
            overflow-y: auto;
            border: 1px solid #333;
            padding: 10px;
            margin-bottom: 10px;
        }
        button {
            padding: 10px;
            background-color: #0066cc;
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        #api-key-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #222;
            color: #fff;
            border: none;
            font-size: 16px;
        }
        .card {
            background-color: #222;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .card.expanded {
            height: 200px;
            overflow-y: auto;
        }
        #canvas-container {
            position: relative;
            width: 100%;
            height: 300px;
            border: 1px solid #333;
        }
        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }
        #help-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        #help-panel {
            position: fixed;
            bottom: 0;
            right: 0;
            width: 300px;
            height: 0;
            background-color: rgba(0, 0, 0, 0.8);
            overflow: hidden;
            transition: height 0.3s;
        }
        #help-content {
            padding: 20px;
        }
        #starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        #transcription {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        #debug-box {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 200px;
            height: 100px;
            background-color: rgba(0, 0, 0, 0.7);
            border: 1px solid #333;
            padding: 10px;
            font-size: 10px;
            overflow-y: auto;
            color: #00FF00;
        }
        .fading-text {
            animation: fadeInOut 4s infinite;
        }
        .old-text {
            color: #888;
        }
    </style>
</head>
<body>
    <canvas id="starfield"></canvas>
    <div id="main-container">
        <div id="left-panel">
            <input type="password" id="api-key-input" placeholder="Enter your OpenAI API key">
            <div id="transcription"></div>
            <div id="canvas-container">
                <canvas id="drawing-canvas"></canvas>
            </div>
        </div>
        <div id="right-panel">
            <div id="chat-history"></div>
        </div>
    </div>
    <button id="help-button">Help</button>
    <button id="fullscreen-button">Fullscreen</button>
    <button id="toggle-ai-inference">Toggle AI Inference</button>
    <select id="theme-selector">
        <option value="dark">Dark Theme</option>
        <option value="light">Light Theme</option>
        <option value="blue">Blue Theme</option>
    </select>
    <div id="help-panel">
        <div id="help-content">
            <h2>Help Instructions</h2>
            <p>1. Enter your OpenAI API key at the top.</p>
            <p>2. Use voice commands for all interactions.</p>
            <p>3. Say "draw rectangle" or "draw circle" for drawing.</p>
            <p>4. Say "summarize chat" to get a conversation summary.</p>
            <p>5. Use "store output" to save important information.</p>
            <p>6. Say "open card 1" or "show card 2" to view saved info.</p>
            <p>7. Say "change color to red" to modify drawing colors.</p>
            <p>8. Say "generate image of [description]" for image creation.</p>
        </div>
    </div>
    <div id="debug-box"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // OpenAI API integration
        const apiKeyInput = document.getElementById('api-key-input');
        const chatHistory = document.getElementById('chat-history');
        const rightPanel = document.getElementById('right-panel');
        const helpButton = document.getElementById('help-button');
        const helpPanel = document.getElementById('help-panel');
        const canvas = document.getElementById('drawing-canvas');
        const ctx = canvas.getContext('2d');
        const transcriptionDiv = document.getElementById('transcription');
        const debugBox = document.getElementById('debug-box');
        const fullscreenButton = document.getElementById('fullscreen-button');
        const toggleAiInferenceButton = document.getElementById('toggle-ai-inference');
        const themeSelector = document.getElementById('theme-selector');

        let chatMessages = [];
        let cardCount = 0;
        let isListening = false;
        let isAiInferenceEnabled = true;

        // Set up canvas
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;

        // Starfield animation
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('starfield') });
        renderer.setSize(window.innerWidth, window.innerHeight);

        const starGeometry = new THREE.BufferGeometry();
        const starMaterial = new THREE.PointsMaterial({ color: 0xFFFFFF, size: 0.1 });
        const starVertices = [];
        for (let i = 0; i < 10000; i++) {
            const x = (Math.random() - 0.5) * 2000;
            const y = (Math.random() - 0.5) * 2000;
            const z = (Math.random() - 0.5) * 2000;
            starVertices.push(x, y, z);
        }
        starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
        const stars = new THREE.Points(starGeometry, starMaterial);
        scene.add(stars);

        camera.position.z = 1;

        function animateStars() {
            requestAnimationFrame(animateStars);
            stars.rotation.y += 0.0002;
            renderer.render(scene, camera);
        }
        animateStars();

        // Event listeners
        helpButton.addEventListener('click', toggleHelpPanel);

        // Start continuous voice recognition
        startContinuousVoiceRecognition();

        // Functions
        async function processVoiceCommand(command) {
            updateDebugBox('Processing command: ' + command);

            if (command.toLowerCase().includes('summarize chat')) {
                summarizeChat();
            } else if (command.toLowerCase().startsWith('draw ')) {
                handleDrawCommand(command);
            } else if (command.toLowerCase().startsWith('change color to ')) {
                changeColor(command.toLowerCase().replace('change color to ', ''));
            } else if (command.toLowerCase().startsWith('store output')) {
                storeOutput(command.replace('store output', '').trim());
            } else if (command.toLowerCase().match(/^(open|show) card \d+$/)) {
                const cardNumber = parseInt(command.match(/\d+/)[0]);
                showCard(cardNumber);
            } else if (command.toLowerCase().startsWith('generate image of ')) {
                await generateImage(command.replace('generate image of ', '').trim());
            } else {
                const response = await getAIResponse(command);
                addToChatHistory('AI', response);
                speakResponse(response);
            }
        }

        async function getAIResponse(message) {
            updateDebugBox('Fetching AI response...');
            const apiKey = apiKeyInput.value;
            if (!apiKey) {
                return 'Please enter your OpenAI API key.';
            }

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [{ role: 'user', content: message }]
                    })
                });

                const data = await response.json();
                updateDebugBox('AI response received');
                return data.choices[0].message.content;
            } catch (error) {
                console.error('Error:', error);
                updateDebugBox('Error fetching AI response');
                return 'An error occurred while fetching the AI response.';
            }
        }

        async function generateImage(prompt) {
            updateDebugBox('Generating image...');
            const apiKey = apiKeyInput.value;
            if (!apiKey) {
                addToChatHistory('System', 'Please enter your OpenAI API key.');
                return;
            }

            try {
                const response = await fetch('https://api.openai.com/v1/images/generations', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        n: 1,
                        size: "256x256"
                    })
                });

                const data = await response.json();
                if (data.data && data.data[0].url) {
                    const imgElement = document.createElement('img');
                    imgElement.src = data.data[0].url;
                    imgElement.alt = prompt;
                    imgElement.style.maxWidth = '100%';
                    addToChatHistory('AI', '');
                    chatHistory.lastElementChild.appendChild(imgElement);
                    updateDebugBox('Image generated successfully');
                } else {
                    addToChatHistory('System', 'Failed to generate image.');
                    updateDebugBox('Failed to generate image');
                }
            } catch (error) {
                console.error('Error:', error);
                addToChatHistory('System', 'An error occurred while generating the image.');
                updateDebugBox('Error generating image');
            }
        }

        function addToChatHistory(role, message) {
            chatMessages.push({ role, message });
            const messageElement = document.createElement('p');
            messageElement.innerHTML = `<strong>${role}:</strong> ${message}`;
            chatHistory.appendChild(messageElement);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        function summarizeChat() {
            updateDebugBox('Summarizing chat...');
            const summary = chatMessages.map(msg => `${msg.role}: ${msg.message}`).join('\n');
            addToChatHistory('System', 'Chat Summary:\n' + summary);
        }

        function handleDrawCommand(command) {
            updateDebugBox('Drawing: ' + command);
            const shape = command.toLowerCase().replace('draw ', '').replace('show ', '');
            ctx.beginPath();
            switch (shape) {
                case 'rectangle':
                    ctx.rect(50, 50, 100, 80);
                    break;
                case 'circle':
                    ctx.arc(100, 100, 50, 0, 2 * Math.PI);
                    break;
                case 'triangle':
                    ctx.moveTo(100, 50);
                    ctx.lineTo(50, 150);
                    ctx.lineTo(150, 150);
                    ctx.closePath();
                    break;
                // Add more shapes as needed
            }
            ctx.stroke();
        }

        function changeColor(color) {
            updateDebugBox('Changing color to: ' + color);
            ctx.strokeStyle = color;
        }

        function storeOutput(content) {
            updateDebugBox('Storing output...');
            cardCount++;
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `<strong>Card ${cardCount}:</strong> ${content}`;
            card.addEventListener('click', () => card.classList.toggle('expanded'));
            rightPanel.appendChild(card);
        }

        function showCard(cardNumber) {
            updateDebugBox('Showing card: ' + cardNumber);
            const cards = rightPanel.getElementsByClassName('card');
            if (cardNumber > 0 && cardNumber <= cards.length) {
                cards[cardNumber - 1].classList.add('expanded');
            }
        }

        function startContinuousVoiceRecognition() {
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'en-US';
            recognition.continuous = true;
            recognition.interimResults = true;

            recognition.onstart = () => {
                isListening = true;
                updateDebugBox('Voice recognition started');
            };

            recognition.onresult = (event) => {
                let interimTranscript = '';
                let finalTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        finalTranscript += event.results[i][0].transcript;
                        processVoiceCommand(finalTranscript.trim());
                    } else {
                        interimTranscript += event.results[i][0].transcript;
                    }
                }

                transcriptionDiv.innerHTML = '<span class="fading-text">' + finalTranscript + '</span><i style="color: #999;">' + interimTranscript + '</i>';
                updateChatHistory(finalTranscript);
            };

            recognition.onend = () => {
                updateDebugBox('Voice recognition ended, restarting...');
                recognition.start();
            };

            recognition.start();
        }

        function updateChatHistory(text) {
            const messageElement = document.createElement('p');
            messageElement.innerHTML = `<strong>You:</strong> ${text}`;
            chatHistory.appendChild(messageElement);
            chatHistory.scrollTop = chatHistory.scrollHeight;

            // Make older messages gray
            const messages = chatHistory.getElementsByTagName('p');
            for (let i = 0; i < messages.length - 1; i++) {
                messages[i].classList.add('old-text');
            }
        }

        function speakResponse(text) {
            updateDebugBox('Speaking response...');
            const utterance = new SpeechSynthesisUtterance(text);
            window.speechSynthesis.speak(utterance);
        }

        function toggleHelpPanel() {
            helpPanel.style.height = helpPanel.style.height === '300px' ? '0' : '300px';
        }

        function updateDebugBox(message) {
            debugBox.innerHTML += message + '<br>';
            debugBox.scrollTop = debugBox.scrollHeight;
        }

        // Window resize handler
        window.addEventListener('resize', () => {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Fullscreen button handler
        fullscreenButton.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        });

        // Toggle AI Inference button handler
        toggleAiInferenceButton.addEventListener('click', () => {
            isAiInferenceEnabled = !isAiInferenceEnabled;
            toggleAiInferenceButton.textContent = isAiInferenceEnabled ? 'Disable AI Inference' : 'Enable AI Inference';
        });

        // Theme selector handler
        themeSelector.addEventListener('change', (event) => {
            document.body.className = event.target.value + '-theme';
        });

        // Update help content
        function updateHelpContent() {
            const helpContent = document.getElementById('help-content');
            helpContent.innerHTML = `
                <h2>Help Instructions</h2>
                <p>1. Enter your OpenAI API key at the top.</p>
                <p>2. Use voice commands for all interactions.</p>
                <p>3. Say "draw rectangle", "draw circle", or "draw triangle" for drawing.</p>
                <p>4. Say "summarize chat" to get a conversation summary.</p>
                <p>5. Use "store output" to save important information.</p>
                <p>6. Say "open card 1" or "show card 2" to view saved info.</p>
                <p>7. Say "change color to [color]" to modify drawing colors.</p>
                <p>8. Say "generate image of [description]" for image creation.</p>
                <p>9. Click the "Fullscreen" button for VR mode.</p>
                <p>10. Use the "Toggle AI Inference" button to enable/disable AI responses.</p>
                <p>11. Select a theme from the dropdown to change the color scheme.</p>
                <p>12. If voice recognition stops, click the "Help" button to see these instructions.</p>
            `;
        }

        updateHelpContent();

        // Add moving stars to the background
        function createMovingStars() {
            const starCount = 200;
            const starField = document.createElement('div');
            starField.style.position = 'fixed';
            starField.style.top = '0';
            starField.style.left = '0';
            starField.style.width = '100%';
            starField.style.height = '100%';
            starField.style.overflow = 'hidden';
            starField.style.zIndex = '-1';

            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.style.position = 'absolute';
                star.style.width = '2px';
                star.style.height = '2px';
                star.style.backgroundColor = 'white';
                star.style.borderRadius = '50%';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animation = `moveStar ${Math.random() * 10 + 5}s linear infinite`;
                starField.appendChild(star);
            }

            document.body.appendChild(starField);
        }

        createMovingStars();

        // Add CSS for moving stars and themes
        const style = document.createElement('style');
        style.textContent = `
            @keyframes moveStar {
                from { transform: translateY(0); }
                to { transform: translateY(100vh); }
            }
            .dark-theme { background-color: #000; color: #fff; }
            .light-theme { background-color: #fff; color: #000; }
            .blue-theme { background-color: #001f3f; color: #7FDBFF; }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
